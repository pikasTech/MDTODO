## 开发必读

### CSS 样式文件说明

**正确的做法**：在 React 组件中导入 CSS，由 webpack 打包内联到 bundle.js。

```typescript
// TaskList.tsx
import './TaskList.css';
```

**禁止**：
- ~~`resources/style.css`~~ - 已被废弃，不再使用
- ~~`src/webview/bundle.css`~~ - 未被导入，不会生效

所有 webview 样式添加到 `src/webview/components/TaskList.css`。

### Webpack 构建产物

- `resources/bundle.js` - webpack 从 `src/webview/index.tsx` 打包生成（包含 React 代码 + TaskList.css 样式内联）
- `out/extension.js` - webpack 从 `src/extension.ts` 打包生成的扩展代码

- 必须使用 `npm.cmd` 而不是 `npm` 来执行 npm 命令，否则 windows 下会无效。

- 编译命令 `npm.cmd run compile`

- 运行 install.bat 打包脚本的正确方式（PowerShell）：
```powershell
powershell -ExecutionPolicy Bypass -Command "cd 'd:\Work\vscode-mdtodo'; .\install.bat"
```

- 历史 TODO 见：[历史 TODO](./20260120_MDTODO.md)

## 总需求

开发一个 VSCODE 插件，功能是渲染TODO文件为树形任务列表，支持Claude Code集成任务执行。
详见 [总需求](./details/20260120_MDTODO/R0_总需求说明.md) 。

## R51 [completed]

**样式问题**

webview的左右间距过大，总的滑动条也太宽，应该用更细的现代的滑动条样式，并且将webview最外面的左右的间距设为0, 完成任务后将详细报告写入[R51](./details/20260120_MDTODO/20260123_1730_Task_Report.md)。

### R51.1 [completed]

子任务任务块的缩进太多了，浪费了左侧的空间, 完成任务后将详细报告写入[R51.1](./details/20260120_MDTODO/20260123_1735_Task_Report.md)。

### R51.1.1 [completed]

缩了一部分，但是子任务块的左侧还有一个竖线，R51.1的修改只是减少了子任务快和竖线的间隔，但是竖线还是缩进很多，竖线的缩进也就是竖线和任务块左侧的缩进也要减少, 完成任务后将详细报告写入[R51.1.1](./details/20260120_MDTODO/20260123_1747_Task_Report.md)。

### R51.2 [completed]

第一次启动MDTODO且没有右侧的标签栏的时候，会创建一个很窄的右侧标签栏，我希望更宽，占vscode的50%的标签栏的总宽度，也就是创建右侧标签栏的时候对半分, 完成任务后将详细报告写入[R51.2](./details/20260120_MDTODO/20260123_1737_Task_Report.md)。

### R51.3 [completed]

当任务块的子任务块里面有滚动条的时候，任务块应该向子任务块投影一个阴影，提示用户这个地方是被遮挡了，可以滚动上去，或者滚动下去，但是如果滚动到顶部那么顶部不应该有阴影，滚动到底部应该底部没有阴影，阴影暗示的是被遮挡了，可以滚动来查看的意思。

执行记录写入 [R51.3](./details/20260120_MDTODO/R51.3_Task_Report.md)。

### R51.3.1 [completed]

阴影没有正常显示, 完成任务后将详细报告写入[R51.3.1](./details/20260120_MDTODO/20260123_1749_Task_Report.md)。

### R51.4 [completed]

点击任务块的收起按钮之后，这个任务快的子任务的滑块自动滚动到最底部, 完成任务后将详细报告写入[R51.4](./details/20260120_MDTODO/R51.4_Task_Report.md)。

### R51.4.1 [completed]

没有滚动, 完成任务后将详细报告写入[R51.4.1](./details/20260120_MDTODO/R51.4.1_Task_Report.md)。

### R51.5 [completed]

"搜索，跳转"这个栏太占地方，应当默认向上收起，鼠标移动到标题页的时候，才下拉出现，应当注意无论向上收起还是向下下拉出现，都不应该推挤task的内容，而是遮挡上方的task的内容, 完成任务后将详细报告写入[R51.5](./details/20260120_MDTODO/R51.5_Task_Report.md)。

### R51.5.1 [completed]

还是推挤了下面的任务块, 完成任务后将详细报告写入[R51.5.1](./details/20260120_MDTODO/R51.5.1_Task_Report.md)。

### R51.5.2 [completed]

还是推挤，不是只在上面覆盖, 完成任务后将详细报告写入[R51.5.2](./details/20260120_MDTODO/20260123_1828_Task_Report.md)。

### R51.5.3 [completed]

推挤问题还是没有解决，我看需要更彻底的处理方式，应当将这个栏彻底重写成一个浮动的块，这样就彻底不会导致推挤了。

执行记录写入 [R51.5.3](./details/20260120_MDTODO/20260123_2357_Task_Report.md)。

### R51.5.4 [completed]

竟然还没有解决，干什么吃的，我要求你彻底删除这个块，在后续的步骤中再重建，这个步骤中删掉这个块（只删掉UI渲染，处理逻辑不删）, 完成任务后将详细报告写入[R51.5.4](./details/20260120_MDTODO/20260124_0007_Task_Report.md)。

### R51.5.5 [completed]

重建这个块，用一个新的ts组件来完成这个块的重建，这个块应该是完全浮动在最外面的, 完成任务后将详细报告写入[R51.5.5](./details/20260120_MDTODO/20260124_0015_Task_Report.md)。

### R51.5.6 [completed]

这个栏布局太多行，右侧太空，另外弹出动画的终止位置虽然正确，但是起始位置不正确，起始位置是最上方，但是应该是从标题栏下端开始弹出才对, 完成任务后将详细报告写入[R51.5.6](./details/20260120_MDTODO/20260124_0026_Task_Report.md)。

### R51.5.7 [completed]

下拉跳转，搜索，新增任务都应该转移到标题栏里面，以标题栏同样风格的图表的形式来做，另外标题栏的字号和所有的图表都小一号, 完成任务后将详细报告写入[R51.5.7](./details/20260120_MDTODO/R51.5.7_Task_Report.md)。

### R51.5.8 [completed]

取消浮动栏，筛选做成一个下拉菜单到标题栏, 完成任务后将详细报告写入[R51.5.8](./details/20260120_MDTODO/20260124_0107_Task_Report.md)。

### R51.5.9 [completed]

取消标题栏左侧的标题，另外标题栏的搜索和下拉菜单样式完全没有生效, 完成任务后将详细报告写入[R51.5.9](./details/20260120_MDTODO/20260124_0114_Task_Report.md)。

### R51.6 [completed]

跳转，搜索，筛选的样式依旧完全没有生效，这说明之前的改动都是没有意义的，应当深入分析底层原因再改, 完成任务后将详细报告写入[R51.6](./details/20260120_MDTODO2/20260124_0120_Task_Report.md)。

**根本原因**: CSS加载机制不一致 - webview从`resources/style.css`加载样式，但新样式只添加到了`src/webview/bundle.css`中，未被使用。

**解决方案**: 将缺失的样式同步到`resources/style.css`。

### R51.7 [completed]

当宽度不够的时候，标题栏应该可以自动变成两行，而不是右侧的按钮无法显示，另外，跳转到下一个未完成的任务的右上角数字标记超出最上面的上限被截断了, 完成任务后将详细报告写入[R51.7](./details/20260120_MDTODO2/20260124_0145_Task_Report.md)。

### R51.8 [completed]

跳转下拉菜单在完成一次跳转后，应当复位到“跳转”状态，而不是保持被定位的ID, 完成任务后将详细报告写入[R51.8](./details/20260120_MDTODO2/20260124_0147_Task_Report.md)。

### R51.9 [completed]

跳转到子任务不应当导致子任务被展开，如果是折叠模式，应当在折叠模式下完成跳转, 真正滚动的子任务，例如R3.14，则是两个滚动操作：（1）滚动到R3的子任务附近。（2）滚动R3的子任务的内部滚动条，滚动到R3.14
完成任务后将详细报告写入[R51.9](./details/20260120_MDTODO2/20260124_0148_Task_Report.md)。

### R51.10 [completed]

折叠和展开按钮应该合二为一，变成一个带状态的按钮，且不同的状态有颜色区分, 完成任务后将详细报告写入[R51.10](./details/20260120_MDTODO2/20260124_0149_Task_Report.md)。

### R51.10.1 [completed]

合并按钮的效果没有生效, 完成任务后将详细报告写入[R51.10.1](./details/20260120_MDTODO2/20260124_0237_Task_Report.md)。

### R51.11 [completed]

标题栏的添加任务按钮也要改成和其他按钮类似的风格和高度，不要蓝色, 完成任务后将详细报告写入[R51.11](./details/20260120_MDTODO2/20260124_0245_Task_Report.md)。

### R51.12 [completed]

跳转功能在跳转例如R1.3.2时，实际跳转到的是R1.3，解决这个问题，真正跳到R1.3.2，另外，双重跳转中，外层跳转后位于顶部（目前已经是这样），内层跳转后居中（需要修改）, 完成任务后将详细报告写入[R51.12](./details/20260120_MDTODO2/20260124_1333_Task_Report.md)。

### R51.13 [completed]

双重跳转的效果之前做好了又丢失了，在折叠状态下，双重跳转后应该是, 最外层（R2）在顶部，内层居中（R2.2,R2.3.1,R2.2.2.2都是内层)，完成任务后将详细报告写入[R51.13](./details/20260120_MDTODO2/20260124_1358_Task_Report.md)。

### R51.14 [completed]

现在折叠状态下的跳转还是有问题，折叠下的正确行为：
1. 顶级Rx跳转到顶部，并且要完整显示Rx的内容（现在Rx的底部对齐到了顶端，这样Rx的内容被完全遮盖了）。
2. 内部Rx.x,Rx.x.x等都要跳转到居中，这个居中指的是内部滚动条的居中，不动外部滚动条，外部滚动条由1的原则来跳转（现在有时候置顶，有时候居中，有时候又不滚动）, 先深入调研问题的原因，形成调查报告，先不执行。, 完成任务后将详细报告写入[R51.14](./details/20260120_MDTODO2/20260124_1437_Task_Report.md)。

### R51.15 [completed]

按照R51.14的方案执行, 完成任务后将详细报告写入[R51.15](./details/20260120_MDTODO2/20260124_1442_Task_Report.md)。

### R51.16 [completed]

跳转，搜索，筛选的输入框高度和图标不一致，调高一点和图标一致, 完成任务后将详细报告写入[R51.16](./details/20260120_MDTODO2/20260124_1454_Task_Report.md)。

### R51.17 [completed]

执行中的高亮状态显示有问题，RX进入执行中之后，RX.X 即子项目也被显示为执行中，但是RX的执行中只应该高丽RX自身，不应该高亮子项目, 完成任务后将详细报告写入[R51.17](./details/20260120_MDTODO2/20260124_1540_Task_Report.md)。

### R51.18 [completed]

跳转的下一个未完成任务的按钮，应当把进行中的也当作未完成支持跳转, 完成任务后将详细报告写入[R51.18](./details/20260120_MDTODO2/20260124_1631_Task_Report.md)。

## R52 [completed]

**经验总结**

总结当前的这个项目的开发进程和成熟度，分几个开发阶段来总结, 完成任务后将详细报告写入[R52](./details/20260120_MDTODO/R52_项目开发进程与成熟度总结.md)。

### R52.1 [completed]

再次总结当前的系统成熟度和技术债务累计度，系统健康度, 完成任务后将详细报告写入[R52.1](./details/20260120_MDTODO2/20260129_0018_Task_Report.md)。

### R52.2 [completed]

根据实际的项目情况更新 README.md，尤其是指导新用户怎么使用install.bat来安装这个插件，这是一个需要复杂调查的项目，要全面调查当前代码库的全部功能，用skill:mdtodo-commander执行, 完成任务后将详细报告写入[R52.2](./details/20260120_MDTODO2/20260129_1049_Task_Report.md)。

### R52.2.1 [completed]

全面调查当前代码库的所有功能，包括核心模块、特性、命令等，完成任务后将详细报告写入[R52.2.1](./details/20260120_MDTODO2/20260129_1049_R52.2.1_Task_Report.md)。

### R52.2.2 [completed]

调查 install.bat 的具体用法和安装流程，完成任务后将详细报告写入[R52.2.2](./details/20260120_MDTODO2/20260129_1049_R52.2.2_Task_Report.md)。

### R52.2.3 [completed]

读取现有的 README.md 文件，了解当前结构和内容，完成任务后将详细报告写入[R52.2.3](./details/20260120_MDTODO2/20260129_1049_R52.2.3_Task_Report.md)。

### R52.2.4 [completed]

根据调查结果更新 README.md，完善功能说明和安装指南，完成任务后将详细报告写入[R52.2.4](./details/20260120_MDTODO2/20260129_1049_R52.2.4_Task_Report.md)。

## R53 [completed]

**风格调整**

普通文本块的ui渲染和编辑存在问题，会导致```跨行的代码块不显示和丢失，看看是不是多加了什么过滤机制，不应该有过滤, 完成任务后将详细报告写入[R53](./details/20260120_MDTODO2/20260124_1715_Task_Report.md)。

### R53.1 [completed]

我要的正是"代码块作为普通文本块的一部分渲染"，而不是相反，R53的修改方向完全错误, 完成任务后将详细报告写入[R53.1](./details/20260120_MDTODO2/20260124_1728_Task_Report.md)。

### R53.2 [completed]

即使R53.1去掉了codeblock条件，依然无法正常渲染和编辑跨行代码块，这肯定有更深层的原因, 完成任务后将详细报告写入[R53.2](./details/20260120_MDTODO2/20260124_1740_Task_Report.md)。

### R53.3 [completed]

任务块里面的`行内公式`的渲染效果失效了，应该正常渲染行内公式才对, 完成任务后将详细报告写入[R53.3](./details/20260120_MDTODO2/20260124_2002_Task_Report.md)。

### R53.4 [completed]

任务块里面的`行内代码`和跨行代码渲染不正常，行内代码没有渲染，跨行代码渲染成了行内代码
```
跨行代码
test
```

, 完成任务后将详细报告写入[R53.4](./details/20260120_MDTODO2/20260124_2013_Task_Report.md)。

### R53.5 [completed]

还是渲染不正常，在渲染的一瞬间是正常了，但是过了一下马上不正常，一定是哪里触发了额外操作修改了, 完成任务后将详细报告写入[R53.5](./details/20260120_MDTODO2/20260124_2018_Task_Report.md)。

**根本原因**: `marked-katex-extension` 在渲染后执行异步 DOM 修改操作，导致内容闪烁。

**解决方案**: 在配置中添加 `output: 'html'` 选项，确保首次渲染直接输出 HTML。

### R53.6 [completed]

R53.5修改后还是和之前现象一致，说明是深入的问题，要先深入分析，不要修改代码, 完成任务后将详细报告写入[R53.6](./details/20260120_MDTODO2/20260124_2024_Task_Report.md)。

**根本原因**：在 `src/parser/index.ts` 第 262 行存在一个正则表达式 `.replace(/`([^`]+)`/g, '$1')`，这个代码会移除所有行内代码标记（反引号），导致 marked 无法识别代码块。

**解决方案**：删除 parser/index.ts 第 262-265 行的 markdown 格式移除代码，让这些格式能够被 marked 正确渲染。

### R53.7 [completed]

根据 R53.6 的分析结果，删除 parser/index.ts 中的 markdown 格式移除代码，解决代码块渲染问题。

执行记录写入 [R53.7](./details/20260120_MDTODO2/20260124_2027_Task_Report.md)。

### R53.8 [completed]

将是否完成的checkbox放置到标题栏的左边，仅次于task id，这样不管其他图标是否显示，是否完成的checkbox位置不会变动, 完成任务后将详细报告写入[R53.8](./details/20260120_MDTODO2/20260127_1702_Task_Report.md)。

## R54 [completed]

**功能开发**

正在进行的标记改为[in_progress]，已经完成的标记改为[completed], 而且在加载文件的时候，如果发现旧版本的 [progressing]和[finished]，统一替换为[in_progress] 和 [completed] 完成任务后将详细报告写入[R54](./details/20260120_MDTODO2/20260125_1323_Task_Report.md)。

### R54.1 [completed]

在存在链接的任务块中，支持右键链接删除功能，这个功能用于删除链接所指向的文件，应用场景是帮助用户能够快速清理执行报告，然后重复执行任务, 完成任务后将详细报告写入[R54.1](./details/20260120_MDTODO2/20260126_1454_Task_Report.md)。

### R54.1.1 [completed] 

右键链接增加复制路径和复制相对路径两个右键选项，用于复制链接的路径到剪贴板, 完成任务后将详细报告写入[R54.1.1](./details/20260120_MDTODO2/20260126_1613_Task_Report.md)。

### R54.1.1.1 [completed]

复制路径和复制相对路径的路径都不对，复制路径应该是完全路径，从根目录开始，例如C:/xxx/xxx，相对路径应该是相对当前vscode的工作路径，而不是相对于MDTODO, 完成任务后将详细报告写入[R54.1.1.1](./details/20260120_MDTODO2/20260126_1624_Task_Report.md)。

### R54.2 [completed]

右键一个任务/子任务的时候，增加一个选项，复制执行命令，这个功能是将CLADUE执行按钮要执行的命令复制出来，而不是真正执行, 完成任务后将详细报告写入[R54.2](./details/20260120_MDTODO2/20260126_1605_Task_Report.md)。

### R54.3 [completed]

复制命令和实际执行的命令并不一致，应该将实际执行的命令拆分为命令生成和命令执行，复制命令复用拆分后的命令生成函数, 完成任务后将详细报告写入[R54.3](./details/20260120_MDTODO2/20260126_1623_Task_Report.md)。

### R54.4 [completed]

右键链接如果是在屏幕底部触发，那么右键菜单会超出屏幕底部导致无法点选，我觉得应该要自动识别是否超出底部，如果超出则右键菜单向上方弹出而不是下方, 完成任务后将详细报告写入[R54.4](./details/20260120_MDTODO2/20260126_2115_Task_Report.md)。

### R54.5 [completed]

支持日志输出同步实时写入到.vscode/mdtodo/logs/中，日志按照时间戳+{MDTODO_ID}.jsonl 命名，要用单元测试确保这个日志同步输出机制真正可用，用skill:mdtodo-commander严格执行，要做多轮审查验证，完成任务后将详细报告写入[R54.5](./details/20260120_MDTODO2/20260129_1223_Task_Report.md)。

**完成摘要**：
- 创建日志服务 `src/services/logService.ts`
- 在 `claudeService.ts` 中集成日志记录
- 16个单元测试全部通过
- 日志格式：`YYYYMMDDHHmmss_MDTODO_R54_5.jsonl`
- 日志位置：`.vscode/mdtodo/logs/`

### R54.5.1 [completed]

创建日志服务模块 (src/services/logService.ts)，包含日志写入目录创建、文件名生成、JSONL格式写入功能, 完成任务后将详细报告写入[R54.5.1](./details/20260120_MDTODO2/R54.5.1_Task_Report.md)。

### R54.5.2 [completed]

在 claudeService.ts 中集成日志服务，在任务执行时调用日志服务记录执行信息, 完成任务后将详细报告写入[R54.5.2](./details/20260120_MDTODO2/R54.5.2_Task_Report.md)。

### R54.5.3 [completed]

编写单元测试验证日志服务功能：目录创建、文件名生成、日志写入、文件内容读取, 完成任务后将详细报告写入[R54.5.3](./details/20260120_MDTODO2/R54.5.3_Task_Report.md)。

### R54.5.4 [completed]

执行单元测试，验证日志同步输出机制真正可用, 完成任务后将详细报告写入[R54.5.4](./details/20260120_MDTODO2/R54.5.4_Task_Report.md)。

### R54.6 [completed]

**插件全生命周期日志系统**

日志应该是 `.md TODO` 文件的总日志，日志文件名格式为 `YYYYMMDDTHHMMss_{TODO文件名}.jsonl`，例如 `20260129T103000_软著数据仿真.jsonl`。日志需要记录从插件启动到关闭的全过程事件，包括：
- 插件启动/停用
- 文件加载/刷新
- 任务执行状态变化
- 用户交互操作
- 错误和异常

日志位置：`.vscode/mdtodo/logs/`

单元测试必须确保日志真正输出到目录中有文件存在。

完成任务后将详细报告写入[R54.6](./details/20260120_MDTODO2/R54.6_Task_Report.md)。

**完成摘要**：
- 新日志格式：`YYYYMMDDTHHMMss_{TODO文件名}.jsonl`
- 支持插件生命周期日志（activate/deactivate）
- 支持文件操作日志（fileLoaded/fileChange）
- 支持任务事件日志（taskExecute/taskComplete）
- 支持用户交互日志（taskSelected/saveTitle/addTask/deleteTask等）
- 日志采用追加写入模式，不会覆盖
- 22个新单元测试全部通过
- 测试验证文件真正输出到 `.vscode/mdtodo/logs/`

### R54.6.1 [completed]

修改日志服务模块 (src/services/logService.ts)，支持基于TODO文件名的日志文件名格式 `YYYYMMDDTHHMMss_{TODO文件名}.jsonl`，并在 extension.ts 的 activate/deactivate 中记录插件生命周期事件。

### R54.6.2 [completed]

在 extension.ts 中集成日志服务，在插件启动时初始化日志，事件触发时写入日志。

### R54.6.3 [completed]

更新单元测试，确保测试验证日志文件真正输出到 `.vscode/mdtodo/logs/` 目录。

### R54.6.4 [completed]

执行单元测试并验证日志文件真正生成。

### R54.6.5 [completed]

日志的.jsonl应当是一次完整的MDTODO插件生命周期（从启动插件到各种操作到关闭插件）共享的，jsonl 的时间戳前缀应该是启动插件的时候的时间戳, 一次声明周期内只应当存在一个.jsonl。完成任务后将详细报告写入[R54.6.5](./details/20260120_MDTODO2/R54.6.5_Task_Report.md)。

### R54.6.6 [completed]

**问题**：日志系统生成了多个日志文件，没有写到同一个生命周期内的jsonl中。

**根本原因**：`claudeService.ts` 使用旧的 `logAction` 函数生成独立文件名，而不是使用统一的会话日志系统。

**解决方案**：修改 `claudeService.ts` 使用 `logTaskEvent` 函数，集成到统一的会话日志系统中。

执行记录写入 [R54.6.6](./docs/details/20260120_MDTODO2/20260129_1507_Task_Report.md)。

## R55

**BUG 修复**

### R55.1 [completed]

现在编辑完一个顶级任务之后，会导致子任务自动展开，解决这个问题，确保编辑顶级任务后，保持原来的展开/折叠状态, 完成任务后将详细报告写入[R55.1](./details/20260120_MDTODO2/20260126_1452_Task_Report.md)。

### R55.2 [completed]

install.bat在打包的时候，应当排除 doc/ 目录, 完成任务后将详细报告写入[R55.2](./details/20260120_MDTODO2/20260126_1659_Task_Report.md)。

### R55.3 [completed]

解决 install.bat 遇到的编译问题

### R55.4 [completed]

解决编译遇到的 WARNING, 完成任务后将详细报告写入[R55.4](./details/20260120_MDTODO2/20260127_1712_Task_Report.md)。

### R55.5 [completed]

点击一次执行任务之后会重复触发两个任务执行的终端,深入调查原因，增加单元测试复现这个问题然后修复， 完成任务后将详细报告写入[R55.5](./docs/details/20260120_MDTODO2/20260127_1717_Task_Report.md)。

执行记录写入 [R55.5_Task_Report.md](./docs/details/20260120_MDTODO2/20260127_1717_Task_Report.md)。

### R55.6 [completed]

经常出现（>30%）MDTODO的webview面板无法编辑.md的情况，表现方式是点击（已完成）选框，新建任务，修改任务内容之后，右下角会有消息通知，但是实际上没有真正修改.md, 这个是一个偶发的问题，十分棘手，你需要全力最深入地排查各种可能性，并增加调试日志辅助调试，完成任务后将详细报告写入[R55.6](./details/20260120_MDTODO2/20260128_2129_Task_Report.md)。

### R55.7 [completed]

复制路径会出现 d:/Work/vscode-mdtodo/docs/./docs/details/20260120_MDTODO2/20260127_1717_Task_Report.md，docs/./details/20260120_MDTODO2/20260128_2129_Task_Report.md，这中间的/./应当能够被解析优化掉, 要增加单元测试复现并修复。

### R55.8 [completed]

关闭Tag再打开之后，点击各种按钮就没有响应，这是两次打开的日志，第一次是正常的：`D:\Work\ws_to_abc\.vscode\mdtodo\logs\20260129T144054_20260127_软著数据仿真.jsonl
D:\Work\ws_to_abc\.vscode\mdtodo\logs\20260129T144103_20260127_软著数据仿真.jsonl`, 单元测试复现和修复这个问题，完成任务后将详细报告写入[R55.8](./details/20260120_MDTODO2/20260129_1441_Task_Report.md)。

**根本原因**：`webviewProvider.ts` 中的 `messageListenerRegistered` 标志在面板第一次创建时设置为 `true`，面板关闭后没有被重置，导致重新打开时消息监听器没有重新注册。

**解决方案**：添加 `currentPanel` 属性跟踪面板实例，在 `showPanel` 中通过比较面板实例判断是否需要重新注册消息监听器，并在 `dispose` 时重置状态。

### R55.9 [completed]

修复 `package.json` 中缺少 `repository` 字段导致的 VSIX 打包错误，添加仓库 URL 配置后打包成功，完成任务后将详细报告写入[R55.9](./details/20260120_MDTODO2/20260129_1455_Task_Report.md)。

## R56

**架构调整**

### R56.1 [completed]

`src\webview\components` 应该拆分地更细，而不是都塞到一个文件里面导致文件过大，`src\providers\webviewProvider.ts` 也应该拆分, 完成任务后将详细报告写入[R56.1](./details/20260120_MDTODO2/20260126_1708_Task_Report.md)。

### R56.2 [completed]

学习R56.1的经验，继续拆解, 完成任务后将详细报告写入[R56.2](./details/20260120_MDTODO2/20260126_1800_Task_Report.md)。

### R56.3 [completed]

继续分析如何拆解，目标是最长的文件不超过1000行, 形成详细报告，完成任务后将详细报告写入[R56.3](./details/20260120_MDTODO2/R56_3_Task_Report.md)。

### R56.4 [completed]

按照R56.3计划执行, 完成任务后将详细报告写入, 完成任务后将详细报告写入[R56.4](./details/20260120_MDTODO2/20260126_2208_Task_Report.md)。
