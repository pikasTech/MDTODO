# R54.2 任务报告

## 任务描述

右键一个任务/子任务的时候，增加一个选项，复制执行命令，这个功能是将 Claude 执行按钮要执行的命令复制出来，而不是真正执行。

## 修改内容

### 1. 修改右键菜单状态定义 (TaskList.tsx:125-133)

在 `contextMenu` 状态中添加了 `taskTitle` 字段（虽然实际未使用，但保留了扩展性）。

### 2. 修改右键点击处理函数 (TaskList.tsx:762-782)

- 原来：只有在右键点击链接时才显示菜单
- 修改后：右键点击任务任意位置都显示菜单
- 菜单始终包含"复制执行命令"选项，如果有链接则额外显示"删除链接文件"选项

### 3. 新增复制执行命令函数 (TaskList.tsx:799-825)

```typescript
const handleCopyExecuteCommand = () => {
  if (contextMenu && contextMenu.taskId && currentFilePath) {
    // 构造相对路径
    let relativePath = currentFilePath;
    if (currentFilePath.includes('/') || currentFilePath.includes('\\')) {
      const pathParts = currentFilePath.split(/[/\\]/);
      relativePath = pathParts[pathParts.length - 1] || currentFilePath;
    }

    // 构造执行命令
    const command = `claude --dangerously-skip-permissions execute "${relativePath} 中的 ${contextMenu.taskId} 任务"`;

    // 复制到剪贴板
    navigator.clipboard.writeText(command);

    closeContextMenu();
  }
};
```

### 4. 修改右键菜单渲染 (TaskList.tsx:1498-1518)

- "复制执行命令"菜单项始终显示
- "删除链接文件"菜单项仅在存在链接时显示

## 命令格式

复制的命令格式：`claude --dangerously-skip-permissions execute "文件名 中的 R1 任务"`

例如：`claude --dangerously-skip-permissions execute "todo.md 中的 R1 任务"`

## 测试方法

1. 右键点击任意任务块
2. 在弹出菜单中选择"复制执行命令"
3. 验证命令已复制到剪贴板
4. 粘贴验证命令格式正确
