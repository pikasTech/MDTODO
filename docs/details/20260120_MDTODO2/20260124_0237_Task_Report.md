# R51.10.1 任务报告

## 任务描述

合并按钮的效果没有生效。

## 问题分析

通过代码审查发现：

1. **CSS 样式已定义**：在 `src/webview/components/TaskList.css` 中已经存在 `.expand-icon` 和 `.expand-icon.expanded` 的样式定义（第 161-201 行）

2. **理解错误**：最初误以为是每个任务的展开/折叠按钮需要合并，实际上 R51.10 指的是将**标题栏的"全部展开"和"全部收起"按钮合二为一**

3. **缺少实际元素**：虽然有 CSS 样式，但按钮类名 `.expand-icon` 从未被使用

## 解决方案

### 修改文件

1. **`src/webview/components/TaskList.tsx`**：
   - 删除独立的"全部展开"按钮（第 1152-1165 行）
   - 删除独立的"全部收起"按钮（第 1166-1179 行）
   - 创建合并的 `expand-collapse-btn` 按钮，根据当前展开状态显示不同样式

2. **`src/webview/components/TaskList.css`**：
   - 添加 `.expand-collapse-btn` 基础样式
   - 添加 `.expand-collapse-btn.expanded` 展开状态样式

### 功能逻辑

- 点击按钮时判断：如果全部任务已展开，则执行收起操作；否则执行展开操作
- 根据 `expandedTasks.size === allTaskIds.length` 判断当前状态
- 显示不同的 tooltip 提示（"全部展开"或"全部收起"）

## 效果说明

### 折叠状态（可展开）
- 背景色：浅灰色 `rgba(100, 100, 100, 0.15)`
- 边框色：半透明灰色 `rgba(100, 100, 100, 0.3)`
- 图标颜色：灰色 `#888`

### 展开状态（已展开）
- 背景色：浅绿色 `rgba(45, 122, 45, 0.2)`
- 边框色：绿色 `rgba(45, 122, 45, 0.5)`
- 图标颜色：亮绿色 `#4ade4a`

### 悬停效果
- 默认悬停：深灰色背景 `rgba(100, 100, 100, 0.25)`
- 展开状态悬停：更绿的背景 `rgba(45, 122, 45, 0.3)`

现在用户可以一眼看出当前任务列表是全部展开还是全部收起的状态，提升用户体验。
