# R53 任务报告：普通文本块代码块渲染问题修复

## 问题描述

普通文本块的 UI 渲染和编辑存在问题，会导致 ``` 跨行的代码块不显示和丢失。

## 根本原因

在 `src/parser/index.ts` 的 `parseTextBlocks` 方法中，处理 RXX 任务标题时保存文本块的判断条件没有检查 `inCodeBlock` 状态。

**问题代码位置**: 第 157-167 行

```typescript
// 如果是 RXX 任务标题
if (isHeading && hasRxx) {
  // 如果在此之前已经在收集文本块，保存它
  if (inTextBlock && currentBlockLines.length > 0) {  // 缺少 !inCodeBlock 检查
    // 保存文本块...
  }
  ...
}
```

**问题场景**:
1. 代码块开始 ` ``` `
2. 文本块收集开始（`inTextBlock = true`）
3. 遇到 RXX 任务标题
4. 保存文本块时只检查了 `inTextBlock && currentBlockLines.length > 0`
5. **但没有检查 `!inCodeBlock`**
6. 导致代码块内容被错误地保存到普通文本块中

## 修复方案

在保存文本块的条件判断中增加 `!inCodeBlock` 检查：

```typescript
// 【R53修复】如果在此之前已经在收集文本块且不在代码块内，保存它
// 增加 !inCodeBlock 检查，防止代码块内容被错误保存到普通文本块
if (inTextBlock && currentBlockLines.length > 0 && !inCodeBlock) {
```

## 修改文件

- `src/parser/index.ts`: 第 160 行

## 验证结果

- 编译成功
- 代码块内容不再被错误地混入普通文本块
- 普通文本块能够正确识别代码块边界
