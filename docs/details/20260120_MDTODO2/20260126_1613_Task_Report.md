# R54.1.1 执行报告

## 任务描述

右键链接增加"复制路径"和"复制相对路径"两个右键选项，用于复制链接的路径到剪贴板。

## 实现内容

### 1. Webview 端 (TaskList.tsx)

- 添加 `handleCopyLinkPath` 函数：复制链接绝对路径到剪贴板
  - 去除 `file://` 前缀
  - 解码 URL 编码的路径
  - 使用 `navigator.clipboard.writeText` 复制到剪贴板

- 添加 `handleCopyLinkRelativePath` 函数：复制链接相对路径到剪贴板
  - 解析链接路径，去除 `file://` 前缀并解码
  - 尝试计算相对于当前文件目录的相对路径
  - 如果无法计算相对路径，则使用绝对路径

- 在右键菜单 UI 中添加两个新菜单项：
  - "复制路径" - 调用 `handleCopyLinkPath`
  - "复制相对路径" - 调用 `handleCopyLinkRelativePath`

### 2. 菜单项显示逻辑

- 两个复制路径菜单项仅在右键点击链接时显示（`contextMenu.href` 存在）
- 菜单顺序：复制执行命令 > 复制路径 > 复制相对路径 > 删除链接文件

## 修改文件

1. `src/webview/components/TaskList.tsx`
   - 添加 `handleCopyLinkPath` 函数
   - 添加 `handleCopyLinkRelativePath` 函数
   - 在右键菜单中添加两个新菜单项

## 功能说明

1. 用户在任务内容中的链接上右键点击
2. 弹出右键菜单，显示"复制路径"和"复制相对路径"选项
3. 点击"复制路径"：复制链接的绝对路径（去除 file:// 前缀并解码）
4. 点击"复制相对路径"：尝试复制相对于当前文件目录的路径
5. 点击后自动关闭右键菜单

## 注意事项

- 相对路径计算基于当前打开的 TODO 文件所在目录
- 如果链接不在当前文件目录下，相对路径将与绝对路径相同
- 路径中的特殊字符会自动 URL 解码
