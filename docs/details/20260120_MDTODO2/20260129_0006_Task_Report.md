# R55.7 路径规范化修复报告

## 问题描述

复制链接路径时，当链接是相对路径（如 `./docs/details/xxx.md`）时，与当前目录拼接后会产生包含 `/./` 的路径：

- `d:/Work/vscode-mdtodo/docs/./docs/details/20260127_1717_Task_Report.md`
- `docs/./details/20260128_2129_Task_Report.md`

这些 `/./` 应该被规范化移除。

## 问题根因

在 `linkUtils.ts` 和 `useLinkOperations.ts` 中的路径拼接逻辑没有对 `./` 进行规范化处理。

## 解决方案

在路径拼接后添加规范化步骤，移除以下模式：

1. 开头的 `./` 模式
2. 路径中间的 `/./` 模式
3. 路径末尾的 `./` 模式
4. 连续的 `./` 模式（如 `./a/./b/./c`）

### 代码修改

**src/webview/utils/linkUtils.ts:**

```typescript
// 规范化路径：移除开头的 ./ 模式
absolutePath = absolutePath.replace(/^\.\//, '');
// 移除路径中间的 /./ 模式
absolutePath = absolutePath.replace(/\/\.\//g, '/');
// 处理路径末尾的 ./
absolutePath = absolutePath.replace(/\/\.$/, '');
// 处理连续的 ./ 情况
absolutePath = absolutePath.replace(/(\/)\./g, '$1');
```

**src/webview/components/TaskList/hooks/useLinkOperations.ts:**

相同的规范化逻辑应用于 `handleCopyLinkPath` 和 `handleCopyLinkRelativePath` 函数。

## 测试

创建了 `test/r55_7_path_normalization.test.ts` 测试文件，包含 26 个测试用例，覆盖：

- normalizePath 函数的基本测试
- resolveLinkPath 绝对路径解析测试
- resolveRelativePath 相对路径解析测试
- 边界情况测试
- R55.7 特定问题回归测试

所有测试通过。

## 修改文件清单

1. `src/webview/utils/linkUtils.ts` - 复制绝对路径和相对路径函数
2. `src/webview/components/TaskList/hooks/useLinkOperations.ts` - React hooks 中的复制路径函数
3. `test/r55_7_path_normalization.test.ts` - 新增单元测试文件

## 验证

运行 `npm test -- r55_7_path_normalization.test.ts` 验证所有 26 个测试通过。
