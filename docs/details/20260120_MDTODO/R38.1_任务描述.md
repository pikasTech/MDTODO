# R38.1 独立防抖状态实现报告

## 任务描述

防抖状态应该是每个按钮独立的，现在我按一个按钮，其他按钮也在防抖。

## 问题分析

原实现使用单一的 `buttonCooldown: boolean` 状态来控制所有按钮的防抖，导致：
- 点击任意按钮后，所有按钮都会进入 100ms 的冷却状态
- 用户体验卡顿，无法连续操作不同按钮

## 解决方案

将防抖状态改为 `Record<string, boolean>` 类型，为每个按钮分配唯一 ID，实现独立防抖。

### 主要修改

1. **防抖状态类型变更** (`TaskList.tsx:64-80`)
   - 从: `const [buttonCooldown, setButtonCooldown] = React.useState(false);`
   - 到: `const [buttonCooldown, setButtonCooldown] = React.useState<Record<string, boolean>>({});`

2. **按钮ID常量定义**
   ```typescript
   const BUTTON_IDS = {
     EXPAND_ALL: 'expandAll',
     COLLAPSE_ALL: 'collapseAll',
     TOGGLE_COMPLETE: 'toggleComplete',
     REFRESH: 'refresh',
     OPEN_FILE: 'openFile',
     OPEN_SOURCE_FILE: 'openSourceFile',
     ADD_TASK: 'addTask',
     DELETE_TASK: 'deleteTask',
     ADD_SUB_TASK: 'addSubTask',
     SCROLL_TO_TOP: 'scrollToTop',
     SCROLL_TO_BOTTOM: 'scrollToBottom',
     JUMP_TO_NEXT: 'jumpToNext',
   } as const;
   ```

3. **按钮防抖检查和设置方式变更**
   - 检查: `if (buttonCooldown[BUTTON_IDS.EXPAND_ALL])`
   - 设置: `setButtonCooldown(prev => ({ ...prev, [BUTTON_IDS.EXPAND_ALL]: true }))`
   - 清除: `setButtonCooldown(prev => ({ ...prev, [BUTTON_IDS.EXPAND_ALL]: false }))`

4. **任务级按钮的特殊处理**
   - 删除按钮: `buttonCooldown[\`${BUTTON_IDS.DELETE_TASK}_${task.id}\`]`
   - 添加子任务按钮: `buttonCooldown[\`${BUTTON_IDS.ADD_SUB_TASK}_${task.id}\`]`
   - 完成复选框: `buttonCooldown[\`${BUTTON_IDS.TOGGLE_COMPLETE}_${task.id}\`]`

5. **TaskItem 组件更新**
   - 类型定义中添加 `buttonIds` 参数
   - 任务级按钮使用独立的防抖状态

### 删除的状态

删除了 `cooldownMessage` 状态，因为现在不再需要显示全局的冷却提示。

## 修改的文件

- `vscode-mdtodo/src/webview/components/TaskList.tsx`

## 测试验证

编译通过，运行正常。现在每个按钮都有独立的防抖状态：
- 点击"展开"按钮后，"收起"按钮仍然可用
- 点击"刷新"按钮后，"打开文件"按钮仍然可用
- 任务级的删除、子任务按钮也独立防抖

## 效果

用户可以连续点击不同的按钮而不会被阻塞，防抖仅对同一个按钮的快速重复点击生效。
