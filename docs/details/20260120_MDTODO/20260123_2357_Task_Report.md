# R51.5.3 任务报告：筛选栏彻底重写为浮动块

## 任务目标

修复之前版本中筛选栏在展开/收起时仍然推挤任务内容的问题。根据 R51.5 的要求，将筛选栏彻底重写成一个浮动的块，这样就彻底不会导致推挤了。

## 问题分析

之前的修复尝试（R51.5、R51.5.1、R51.5.2）虽然使用了 `position: absolute`，但仍然存在以下问题：

1. **定位不彻底**：虽然使用了绝对定位，但由于 `top` 值的设定和容器高度问题，可能仍然会影响布局
2. **阴影效果缺失**：用户无法直观感知到有浮动内容覆盖在任务列表上方
3. **点击穿透问题**：浮动层可能阻挡下方内容的点击事件

## 解决方案

### 1. 使用 `position: fixed` 彻底脱离文档流

将 `.filter-bar-container` 的定位方式从 `position: absolute` 改为 `position: fixed`：

```css
/* 【实现R51.5.3】筛选栏容器 - 使用fixed定位彻底脱离文档流，不推挤内容 */
.filter-bar-container {
  position: fixed;
  top: 45px; /* header高度略下方 */
  left: 0;
  right: 0;
  z-index: 100;
  pointer-events: none; /* 允许点击穿透到下方的内容 */
}

/* 【实现R51.5.3】筛选栏内容 - pointer-events: auto恢复交互 */
.filter-bar-container > * {
  pointer-events: auto;
}
```

### 2. 添加阴影效果

添加底部阴影效果，让用户知道有浮动内容覆盖在上面：

```css
/* 【实现R51.5.3】浮动栏底部的阴影效果，提示用户有内容覆盖 */
.filter-bar-shadow {
  position: fixed;
  top: 45px;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.3), transparent);
  z-index: 99;
  pointer-events: none;
}
```

### 3. 修改 React 组件结构

在 `TaskList.tsx` 中调整筛选栏的渲染结构：

```tsx
// 【实现R51.5.3】筛选栏容器 - 使用fixed定位覆盖在内容上方，不推挤task内容
tasks.length > 0 && React.createElement('div', null,
  // 筛选栏阴影效果
  filterBarExpanded && React.createElement('div', { className: 'filter-bar-shadow' }),
  React.createElement('div', {
    className: 'filter-bar-container',
    // ... 事件处理
  }, renderFilterBar())
),
```

## 修改文件

1. **src/webview/bundle.css**：
   - 将 `.filter-bar-container` 的 `position` 从 `absolute` 改为 `fixed`
   - 添加 `pointer-events: none` 允许点击穿透
   - 添加 `.filter-bar-shadow` 类实现阴影效果

2. **src/webview/components/TaskList.tsx**：
   - 调整筛选栏容器结构，添加阴影元素的条件渲染

## 技术细节

### CSS 定位机制

```
.position: fixed vs position: absolute:
- fixed: 相对于浏览器窗口定位，完全脱离文档流
- absolute: 相对于最近的定位祖先元素定位

使用 fixed 的优势：
1. 彻底脱离文档流，不会影响其他元素的布局
2. 不受父容器高度变化的影响
3. 滚动时保持固定位置（如需要）
```

### 点击穿透机制

```css
.filter-bar-container {
  pointer-events: none; /* 容器本身不接收点击事件 */
}

.filter-bar-container > * {
  pointer-events: auto; /* 子元素恢复点击交互 */
}
```

这样设计使得：
- 筛选栏展开时，用户仍然可以点击筛选栏下方的任务
- 筛选栏上的按钮和输入框仍然可以正常交互

## 验证方法

1. 启动 MDTODO 插件
2. 验证筛选栏默认显示为收起状态（显示"🔍 搜索 / 跳转"）
3. 鼠标移动到 header 区域，验证筛选栏展开
4. 【关键验证】观察筛选栏展开时：
   - 是否不推挤下方的任务列表内容
   - 是否有阴影效果提示用户有内容覆盖
   - 是否仍然可以点击筛选栏下方的任务
5. 鼠标离开 header 和筛选栏区域，验证筛选栏收起

## 预期结果

筛选栏现在应该：
- ✅ 完全脱离文档流，展开/收起时不推挤任务内容
- ✅ 通过覆盖（遮挡）方式显示在内容之上
- ✅ 具有底部阴影效果，提示用户有浮动内容
- ✅ 允许点击穿透，不阻挡下方内容的交互
- ✅ 保持正确的展开/收起动画效果
- ✅ 保持正确的背景色和边框样式

## 后续优化建议

1. **动画效果**：可以添加更丰富的展开/收起动画
2. **响应式设计**：在小屏幕上可以调整筛选栏的宽度和位置
3. **用户提示**：可以在收起状态下添加更明显的提示，引导用户展开
