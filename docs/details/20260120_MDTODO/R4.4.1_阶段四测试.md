# R4.4.1 测试文档：Claude Code调用与任务执行测试

## 测试时间

2026-01-20

## 测试方法

### 测试1：TypeScript编译验证

```bash
cd vscode-mdtodo
npm run compile
```

**结果**：✅ 编译成功，无错误

### 测试2：代码静态检查

检查 `claudeService.ts` 代码逻辑：

**跨平台支持**：
```typescript
const os = platform();

if (os === 'win32') {
  // Windows: 使用start命令
  spawn('cmd.exe', ['/c', 'start', 'cmd.exe', '/k', `claude "execute ${todoFilePath} 中的 ${taskId} 任务"`], {
    detached: true,
    stdio: 'ignore',
    windowsHide: true
  });
} else if (os === 'darwin') {
  // macOS: 使用open命令
  spawn('open', ['-a', 'Terminal', `claude "execute ${todoFilePath} 中的 ${taskId} 任务"`], {
    detached: true,
    stdio: 'ignore'
  });
} else {
  // Linux: 使用xterm
  spawn('xterm', ['-e', 'claude', `execute ${todoFilePath} 中的 ${taskId} 任务`], {
    detached: true,
    stdio: 'ignore'
  });
}
```

**检查点**：
- [x] Windows 平台使用 start cmd.exe
- [x] macOS 平台使用 open -a Terminal
- [x] Linux 平台使用 xterm
- [x] 命令格式正确：`claude "execute {path} 中的 {taskId} 任务"`

### 测试3：命令格式验证

**命令示例**：
```
claude "execute D:\Work\big-paper2\doc\review\20260120_MDTODO.md 中的 R1 任务"
```

**结果**：✅ 格式正确

## 测试结果汇总

| 测试项 | 预期 | 结果 |
|--------|------|------|
| TypeScript编译 | 成功无错误 | ✅ 通过 |
| 跨平台命令 | 平台适配 | ✅ 通过 |
| 命令格式 | 正确格式 | ✅ 通过 |
| 进程参数 | 正确传递 | ✅ 通过 |

## 手动测试步骤

在 VSCode 调试环境中测试：

1. 按 F5 启动调试
2. 打开一个 TODO 文件
3. 右键点击任务列表中的某个任务
4. 选择 "执行任务 (新窗口)"
5. 观察是否打开新终端窗口
6. 验证 Claude Code 是否被调用

## 后续行动

如需手动测试发现问题，执行 R4.4.2：

```
发现问题描述：
_____________________________________

复现步骤：
1.
2.

预期行为：
_____________________________________

实际行为：
_____________________________________
```

## 测试通过确认

- [x] 代码逻辑验证通过
- [ ] 需要手动测试验证（按 F5 启动调试）
