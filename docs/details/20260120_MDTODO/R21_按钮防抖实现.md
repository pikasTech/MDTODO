# R21 按钮防抖执行记录

**任务**: 所有按钮都要有类似Claude执行按钮的防抖，避免误触

**状态**: Completed

**日期**: 2026-01-21

## 修改文件

1. `vscode-mdtodo/src/webview/components/TaskList.tsx` - 添加通用按钮防抖逻辑
2. `vscode-mdtodo/src/webview/components/TaskList.css` - 添加禁用状态样式

## 实现内容

### 1. 新增防抖状态

```typescript
// 通用按钮防抖状态
const [buttonCooldown, setButtonCooldown] = React.useState(false);
const BUTTON_COOLDOWN = 500; // 0.5秒冷却
// 冷却中的按钮提示文本
const [cooldownMessage, setCooldownMessage] = React.useState<string | null>(null);
```

### 2. 应用防抖的按钮

所有以下按钮现在都应用了0.5秒防抖：

- **头部操作按钮**: 全部展开、全部收起、刷新、打开文件、预览
- **筛选栏按钮**: 添加任务
- **任务项按钮**: +子任务、删除、编辑
- **任务复选框**: 完成/未完成切换

### 3. 防抖逻辑

每个按钮处理函数都包含以下逻辑：

```typescript
// 防抖：如果冷却中，不执行
if (buttonCooldown) {
  console.log('[Webview] XXX按钮防抖，跳过重复点击');
  return;
}
// ... 执行实际逻辑 ...
// 设置防抖状态
setButtonCooldown(true);
setCooldownMessage('XXX');
setTimeout(() => {
  setButtonCooldown(false);
  setCooldownMessage(null);
}, BUTTON_COOLDOWN);
```

### 4. 视觉反馈

所有按钮在冷却期间显示禁用状态：

- 添加 `disabled` 属性
- 添加 `disabled` CSS 类
- 样式变化：背景色变暗、文字颜色变灰、光标变为禁止符号

### 5. CSS样式

```css
/* 基础按钮禁用样式 */
.btn-primary.disabled,
.btn-primary:disabled {
  background-color: #4a6a8a;
  color: #888;
  cursor: not-allowed;
  opacity: 0.7;
}

.btn-secondary.disabled,
.btn-secondary:disabled {
  background-color: #2c2c2c;
  color: #666;
  cursor: not-allowed;
  opacity: 0.7;
}

.action-btn.disabled,
.action-btn:disabled {
  background-color: #2c2c2c;
  color: #666;
  cursor: not-allowed;
  opacity: 0.7;
}

.preview-btn.disabled,
.preview-btn:disabled {
  background-color: #4a5a6a;
  color: #888;
  cursor: not-allowed;
  opacity: 0.7;
}
```

## 注意事项

- Claude执行按钮保持独立的 `claudeExecuting` 状态，用于每个任务的单独防抖
- 其他按钮共用 `buttonCooldown` 状态，避免同时触发多个操作
- 筛选按钮（状态筛选、搜索输入）不需要防抖，因为它们是状态切换而非操作触发

## 构建验证

```bash
npm.cmd run compile
# webpack 5.104.1 compiled successfully
```
