# R31 链接点击打开文档执行记录

## 任务描述

点击任务里面的文档链接后没有真实跳转到文档，我希望点击链接后能打开文档。

## 实现方案

分析现有代码后发现，扩展端（webviewProvider.ts）已经有 `handleOpenLink` 方法处理 `openLink` 消息类型。只需在 webview 端添加链接点击事件捕获，发送消息到扩展端即可。

## 修改内容

### 1. TaskList.tsx - 添加任务内容链接点击处理

```typescript
// 处理任务内容中的链接点击
const handleTaskContentClick = (e: React.MouseEvent, taskId: string) => {
  const target = e.target as HTMLElement;
  // 检查是否点击了链接
  if (target.tagName === 'A' && target instanceof HTMLAnchorElement) {
    e.preventDefault();
    e.stopPropagation();
    const href = target.getAttribute('href');
    if (href) {
      console.log('[Webview] 点击链接:', href);
      sendMessage({ type: 'openLink', url: href });
    }
  }
};
```

在任务内容渲染中添加 onClick 处理器：

```typescript
: React.createElement('div', {
    className: 'task-title',
    dangerouslySetInnerHTML: isNewTask ? undefined : { __html: renderContent() },
    onClick: (e: React.MouseEvent) => handleTaskContentClick(e, task.id),
    style: { cursor: 'pointer' }
  })
```

### 2. TaskList.tsx - 添加文本块链接点击处理

```typescript
// 处理文本块中的链接点击
const handleTextBlockClick = (e: React.MouseEvent) => {
  const target = e.target as HTMLElement;
  // 检查是否点击了链接
  if (target.tagName === 'A' && target instanceof HTMLAnchorElement) {
    e.preventDefault();
    e.stopPropagation();
    const href = target.getAttribute('href');
    if (href) {
      console.log('[Webview] 点击文本块链接:', href);
      sendMessage({ type: 'openLink', url: href });
    }
  }
};
```

在文本块渲染中添加 onClick 处理器：

```typescript
return React.createElement('div', {
    // ...其他属性
    dangerouslySetInnerHTML: { __html: renderedContent as string },
    onClick: handleTextBlockClick
  });
```

### 3. 执行构建

```bash
cd vscode-mdtodo
npm run compile
```

## 链接类型支持

- **本地文件路径**：如 `./docs/file.md`、`../file.md` 或绝对路径
  - 使用 `vscode.window.showTextDocument()` 打开
- **网页链接**：如 `https://github.com`
  - 使用 `vscode.env.openExternal()` 在浏览器中打开

## 验证方法

1. 在任务内容中添加链接，如：`[测试文档](./test.md)`
2. 点击链接，应能在 VSCode 中打开对应文档
