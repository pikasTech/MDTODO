# R10 Claude执行按钮防抖执行记录

## 任务描述

为 Claude 执行按钮添加防抖功能，设置为 0.5s 的冷却，避免抖动导致多次执行。

## 执行时间

2026-01-21

## 修改文件

1. `vscode-mdtodo/src/webview/components/TaskList.tsx`
2. `vscode-mdtodo/src/webview/components/TaskList.css`

## 修改内容

### 1. TaskList.tsx

添加防抖状态和相关逻辑：

```typescript
// Claude执行按钮防抖状态
const [claudeExecuting, setClaudeExecuting] = React.useState<Record<string, boolean>>({});
const CLAUDE_EXECUTE_COOLDOWN = 500; // 0.5秒冷却
```

修改 `handleClaudeExecute` 函数实现防抖逻辑：

```typescript
const handleClaudeExecute = (taskId: string) => {
  // 防抖：如果正在执行或冷却中，不执行
  if (claudeExecuting[taskId]) {
    console.log('[Webview] Claude执行防抖，跳过重复点击');
    return;
  }
  // 发送执行消息
  sendMessage({ type: 'claudeExecute', taskId });
  // 设置防抖状态
  setClaudeExecuting(prev => ({ ...prev, [taskId]: true }));
  // 0.5秒后清除防抖状态
  setTimeout(() => {
    setClaudeExecuting(prev => ({ ...prev, [taskId]: false }));
  }, CLAUDE_EXECUTE_COOLDOWN);
};
```

更新按钮渲染，添加禁用状态：

```typescript
React.createElement('button', {
  className: `action-btn claude-btn ${claudeExecuting[task.id] ? 'disabled' : ''}`,
  disabled: claudeExecuting[task.id],
  onClick: (e: React.MouseEvent) => {
    e.stopPropagation();
    if (!claudeExecuting[task.id]) {
      onClaudeExecute(task.id);
    }
  },
}, claudeExecuting[task.id] ? '执行中...' : 'Claude执行'),
```

### 2. TaskList.css

添加禁用状态样式：

```css
.action-btn.claude-btn.disabled,
.action-btn.claude-btn:disabled {
  background-color: #6b5b3d;
  color: #999;
  cursor: not-allowed;
  opacity: 0.7;
}
```

## 功能效果

- 点击"Claude执行"按钮后，按钮立即变为禁用状态，显示"执行中..."
- 0.5秒内重复点击会被忽略（控制台输出防抖日志）
- 冷却时间结束后按钮恢复可用状态，重新显示"Claude执行"
- 禁用时按钮显示灰褐色，鼠标指针为禁止符号

## 验证方式

1. 编译插件：`npm run compile`
2. 在VSCode中加载插件
3. 打开TODO文件，点击"Claude执行"按钮
4. 快速连续点击多次，观察是否只有一次执行
5. 观察按钮状态变化（"执行中..." -> "Claude执行"）
