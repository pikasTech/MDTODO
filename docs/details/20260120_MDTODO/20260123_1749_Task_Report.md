# R51.3.1 任务报告：滚动阴影修复

## 任务描述

R51.3 实现了子任务块的滚动阴影功能，但阴影没有正常显示。

## 问题分析

1. **伪元素被 overflow 裁剪**：原实现使用 `::before` 和 `::after` 伪元素配合 `position: absolute`，但当父元素有 `overflow: auto` 时，伪元素会被裁剪，无法显示在滚动区域边缘。

2. **调试日志过多**：滚动状态日志输出过于频繁，影响调试体验。

## 修复方案

### 1. CSS 样式修复 - 使用 sticky 定位

修改 `src/webview/components/TaskList.css`，改用 `position: sticky` 实现阴影：

```css
/* 使用sticky定位避免被overflow裁剪 */
.scroll-shadow-top {
  position: sticky;
  top: 0;
  left: 0;
  right: 0;
  height: 32px;
  background: linear-gradient(to bottom, rgba(30, 30, 30, 0.95), transparent);
  opacity: 0;
  pointer-events: none;
  z-index: 5;
  transition: opacity 0.15s ease;
  margin-bottom: -32px;
}

.scroll-shadow-bottom {
  position: sticky;
  bottom: 0;
  left: 0;
  right: 0;
  height: 32px;
  background: linear-gradient(to top, rgba(30, 30, 30, 0.95), transparent);
  opacity: 0;
  pointer-events: none;
  z-index: 5;
  transition: opacity 0.15s ease;
  margin-top: -32px;
}

.children.collapsed-preview.can-scroll-up .scroll-shadow-top {
  opacity: 1;
}

.children.collapsed-preview.can-scroll-down .scroll-shadow-bottom {
  opacity: 1;
}
```

**关键点**：
- 使用 `position: sticky` 让阴影元素固定在容器顶部和底部
- `sticky` 元素不会被 `overflow: auto` 裁剪
- 添加 `margin-bottom: -32px` 和 `margin-top: -32px` 确保阴影与内容重叠

### 2. 添加阴影元素到 DOM

修改 `src/webview/components/TaskList.tsx`，在子任务容器中添加顶部和底部阴影元素：

```tsx
hasChildren && React.createElement('ul', {
  ref: childrenRef,
  className: `children${!isExpanded ? ' collapsed-preview' : ''}${canScrollUp ? ' can-scroll-up' : ''}${canScrollDown ? ' can-scroll-down' : ''}`,
  style: childrenStyle
},
  // 顶部滚动阴影 - 使用sticky定位
  !isExpanded && React.createElement('div', { className: 'scroll-shadow-top' }),
  // 子任务列表...
  (task.children || []).map(...),
  // 底部滚动阴影 - 使用sticky定位
  !isExpanded && React.createElement('div', { className: 'scroll-shadow-bottom' })
)
```

### 3. 注释掉高频调试日志

注释掉以下高频日志以减少控制台输出：
- `[R51.3.1] 滚动状态` 日志
- `[R48.3] 自动滚动到底部` 日志
- `webviewActive` 消息发送

## 文件修改

1. `src/webview/components/TaskList.css` - 改用 sticky 定位实现滚动阴影
2. `src/webview/components/TaskList.tsx` - 添加阴影元素，注释高频日志

## 测试方法

1. 打开一个有很多子任务的任务（如 R1）
2. 收起该任务（点击折叠按钮）
3. 观察子任务区域：
   - 滚动到顶部：顶部阴影应消失，底部阴影显示
   - 滚动到底部：底部阴影应消失，顶部阴影显示
   - 在中间位置：顶部和底部阴影应同时显示

## 阴影行为说明

- **顶部阴影**：当子任务容器可以向上滚动时显示（滚动位置 > 0）
- **底部阴影**：当子任务容器可以向下滚动时显示（滚动位置未到底）
- **无滚动时**：内容没有超出容器范围时，不显示任何阴影
- **滚动到顶部**：顶部阴影消失，底部阴影（如果有）显示
- **滚动到底部**：底部阴影消失，顶部阴影（如果有）显示
- **中间位置**：顶部和底部阴影同时显示
