# R23 编号列表编辑修复执行报告

## 问题描述

如同（1. 2. ）这样的编号在编辑时会消失，这意味着编辑时没有真正获得最原始的文本。

## 问题分析

在 `parser/index.ts` 的 `parseTask` 函数中，对任务内容进行了多项格式化处理，其中第263行：
```typescript
.replace(/^\s*\d+\.\s+/gm, '')  // 移除数字列表
```
会将 `1. `、`2. ` 等编号列表移除。

解析后的 `task.title` 已经丢失了编号信息，当 webview 进入编辑模式时，使用的是已经被处理过的 `task.title`，而不是原始的 markdown 文本。

## 解决方案

1. 在 `types/index.ts` 中为 `TodoTask` 接口添加 `rawContent` 字段，用于存储原始内容
2. 在 `parser/index.ts` 中修改 `getFullTaskContent` 返回原始内容
3. 在 `webviewProvider.ts` 中传递 `rawContent` 到 webview
4. 在 `TaskList.tsx` 中编辑时使用 `rawContent` 而不是处理后的 `title`

## 修改的文件

1. **src/types/index.ts** - 添加 `rawContent` 字段
2. **src/parser/index.ts** - 修改 `getFullTaskContent` 和 `parseTask` 方法
3. **src/providers/webviewProvider.ts** - 修改 `serializeTasks` 方法
4. **src/webview/components/TaskList.tsx** - 修改 Task 接口和编辑逻辑

## 测试验证

创建单元测试 `test/numberedListEdit.test.ts`，测试编号列表在编辑时是否保留。

测试结果：
```
PASS test/numberedListEdit.test.ts
  R23 编号列表编辑测试
    问题复现
      √ 带编号列表的任务内容在解析时编号会被移除
      √ 修复后：带编号列表的任务内容应该保留编号
    编辑时获取原始内容
      √ 编辑时应该获取原始的markdown内容
      √ 编辑时应该保留括号编号格式 (1) (2)
    实际场景测试
      √ 模拟完整的编辑流程
```

## 修复效果

- 编辑任务时，`(1)`、`(2)`、`1.`、`2.` 等编号格式会被完整保留
- 非编辑模式下显示仍使用格式化后的 `title`（用于 markdown 渲染）
- 编辑模式下使用原始的 `rawContent`，保留所有格式

## 构建验证

```bash
npm run compile  # 编译成功
npm test         # 编号列表测试全部通过
```
