# R29.3 双向滚动同步开关失效修复

## 问题描述

在R29.2实现的双向滚动同步开关功能中，即使关闭了开关（`syncScrollEnabled`为false），仍然触发了同步滚动。

## 问题根因

`handleScroll` 函数的依赖项中包含 `syncScrollEnabled`（第671行），但监听滚动事件的 `useEffect` 依赖项只包含 `[handleScroll, notifyWebviewActive]`，没有包含 `syncScrollEnabled`。

这导致的问题是：
1. 当开关状态变化时，`handleScroll` 函数会重新创建
2. 但 `useEffect` 只在 mount 时执行一次，它捕获了 `handleScroll` 的初始版本
3. 旧的事件监听器仍然在使用旧的 `handleScroll` 版本，忽略了开关状态的变化

## 修复方案

将 `syncScrollEnabled` 添加到 `useEffect` 的依赖项中：

```typescript
// 【实现R29】添加滚动事件监听器
// 【修复R29.3】将 syncScrollEnabled 添加到依赖项，确保开关状态变化时重新绑定事件
React.useEffect(() => {
  const container = document.querySelector('.task-container');
  if (container) {
    // 【实现R29.1】监听滚动事件，先通知webview成为焦点
    const handleScrollWithFocus = () => {
      notifyWebviewActive();
      handleScroll();
    };

    container.addEventListener('scroll', handleScrollWithFocus, { passive: true });

    // 【实现R29.1】监听点击事件，设置webview为焦点
    container.addEventListener('click', notifyWebviewActive, { passive: true });

    return () => {
      container.removeEventListener('scroll', handleScrollWithFocus);
      container.removeEventListener('click', notifyWebviewActive);
    };
  }
}, [handleScroll, notifyWebviewActive, syncScrollEnabled]);  // 【修复R29.3】添加 syncScrollEnabled
```

## 修改文件

- `vscode-mdtodo/src/webview/components/TaskList.tsx`
  - 第702行：添加注释说明修复R29.3
  - 第722行：在依赖项数组中添加 `syncScrollEnabled`

## 测试方法

1. 打开 MDTODO 插件
2. 打开一个 TODO 文件
3. 确认双向滚动同步开关处于关闭状态
4. 滚动 webview 任务列表
5. 验证 VSCode 编辑器不会同步滚动
6. 开启双向滚动同步开关
7. 再次滚动 webview
8. 验证 VSCode 编辑器会同步滚动
