# R54.1 执行报告

## 任务描述

在存在链接的任务块中，支持右键链接删除功能，这个功能用于删除链接所指向的文件，应用场景是帮助用户能够快速清理执行报告，然后重复执行任务。

## 实现内容

### 1. Webview 端 (TaskList.tsx)

- 添加右键菜单状态 `contextMenu`，包含可见性、位置、链接URL和任务ID
- 添加 `handleTaskContentContextMenu` 函数：处理任务内容中的右键点击，识别链接元素并显示右键菜单
- 添加 `closeContextMenu` 函数：关闭右键菜单
- 添加 `handleDeleteLinkFile` 函数：发送 `deleteLinkFile` 消息到 Extension
- 在任务标题区域添加 `onContextMenu` 事件监听器
- 添加右键菜单 UI 组件
- 添加点击外部关闭右键菜单的 useEffect

### 2. Extension 端 (webviewProvider.ts)

- 在消息处理 switch 语句中添加 `case 'deleteLinkFile'` 处理
- 实现 `handleDeleteLinkFile` 方法：
  - 支持相对路径和绝对路径解析
  - 排除 HTTP/HTTPS 链接（无法删除）
  - 检查文件是否存在
  - 检查是否为目录（不删除目录）
  - 弹出确认对话框
  - 执行文件删除
  - 删除成功后刷新 webview 更新链接状态

### 3. 样式 (TaskList.css)

- 添加 `.context-menu` 样式：右键菜单容器样式
- 添加 `.context-menu-item` 样式：菜单项样式，包括 hover 效果

## 修改文件

1. `src/webview/components/TaskList.tsx`
   - 添加右键菜单状态
   - 添加右键菜单处理函数
   - 添加右键菜单 UI 和事件监听

2. `src/providers/webviewProvider.ts`
   - 添加 `deleteLinkFile` 消息处理
   - 实现 `handleDeleteLinkFile` 方法

3. `src/webview/components/TaskList.css`
   - 添加右键菜单样式

## 功能说明

1. 用户在任务内容中的链接上右键点击
2. 弹出右键菜单，显示"删除链接文件"选项
3. 点击"删除链接文件"后，弹出确认对话框
4. 确认后删除文件并刷新 webview
5. 点击菜单外部或取消则关闭菜单

## 注意事项

- 不删除 HTTP/HTTPS 网页链接
- 不删除目录
- 删除前会有确认提示
- 删除后自动刷新 webview 更新链接状态显示
