# R54.1.1.1 任务报告

## 任务描述
修复右键链接的"复制路径"和"复制相对路径"功能：
- 复制路径：应该是完全路径，从根目录开始（例如 C:/xxx/xxx）
- 复制相对路径：应该是相对当前 VSCode 的工作路径，而不是相对于 MDTODO 文件

## 修改内容

### 1. src/providers/webviewProvider.ts

**修改 `sendToWebview` 方法**：
- 添加 `getWorkspaceFolderPath()` 方法获取 VSCode 工作区路径
- 修改 `sendToWebview()` 方法，将 `workspacePath` 作为消息的一部分发送到 webview

```typescript
private getWorkspaceFolderPath(): string {
  const workspaceFolders = vscode.workspace.workspaceFolders;
  if (workspaceFolders && workspaceFolders.length > 0) {
    return workspaceFolders[0].uri.fsPath;
  }
  return '';
}
```

### 2. src/webview/components/TaskList.tsx

**添加 `workspacePath` 状态**：
```typescript
const [workspacePath, setWorkspacePath] = React.useState<string>('');
```

**修改 `handleCopyLinkPath` 函数**：
- 正确处理相对路径链接（先转换为绝对路径）
- 确保返回完全路径（从根目录开始）

**修改 `handleCopyLinkRelativePath` 函数**：
- 使用 `workspacePath` 状态计算相对路径
- 相对于 VSCode 工作区计算相对路径

## 测试方法
1. 在 VSCode 中打开一个包含链接的 TODO 文件
2. 右键点击带有链接的任务
3. 选择"复制路径"和"复制相对路径"
4. 验证复制的路径是否符合预期：
   - 复制路径：应该是完整的绝对路径（如 `C:/project/details/file.md`）
   - 复制相对路径：应该是相对于 VSCode 工作区的路径（如 `details/file.md`）
