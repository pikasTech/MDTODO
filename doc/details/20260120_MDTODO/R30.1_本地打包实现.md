# R30.1 本地打包实现

## 任务目标

实际实现本地打包，并创建一个打包脚本 `pack.bat`，测试好这个脚本。

## 执行步骤

### 1. 安装 vsce 工具

```bash
npm install -g @vscode/vsce
```

### 2. 创建打包脚本 pack.bat

```batch
@echo off
chcp 65001 >nul
echo ============================================
echo VSCode MDTODO Plugin Package Script
echo ============================================
echo.

cd /d "%~dp0"
setlocal

echo [1/3] Building project...
echo.
call npm.cmd run compile
if errorlevel 1 (
    echo ERROR: Build failed!
    exit /b 1
)
echo Build completed.
echo.

echo [2/3] Packaging VSIX...
echo.
call npx vsce package --allow-missing-repository
if errorlevel 1 (
    echo ERROR: Packaging failed!
    exit /b 1
)
echo Packaging completed.
echo.

echo [3/3] Done!
echo.
echo The VSIX file has been created in the current directory.
echo You can install it via:
echo   code --install-extension vscode-mdtodo-0.0.2.vsix
echo.
echo Or install manually in VSCode:
echo   1. Press Ctrl+Shift+P
echo   2. Type "Extensions: Install from VSIX"
echo   3. Select the generated .vsix file
echo.

endlocal
pause
```

### 3. 创建 .vscodeignore 文件

为减少包体积，排除不必要的文件：

```
# Dependencies - always exclude
node_modules/

# Build outputs - dist/ is bundled, but out/ contains TypeScript output needed for vsce
dist/

# Test files - exclude from package
test/
*.test.ts
*.test.tsx
jest.config.js

# Development files
.vscode/
.gitignore
*.log
npm-debug.log*

# OS files
.DS_Store
Thumbs.db

# Temporary
*.tmp
*.temp
nul

# Exclude pack.bat from package (not needed in production)
pack.bat
```

## 测试结果

### 打包输出

```
============================================
VSCode MDTODO Plugin Package Script
============================================

[1/3] Building project...

> vscode-mdtodo@0.0.2 compile
> tsc && webpack

webpack 5.104.1 compiled successfully in 4945 ms
webpack 5.104.1 compiled successfully in 5701 ms
Build completed.

[2/3] Packaging VSIX...

 INFO  Files included in the VSIX:
vscode-mdtodo-0.0.2.vsix
├─ [Content_Types].xml
├─ extension.vsixmanifest
└─ extension/
   ├─ package.json [2.69 KB]
   ├─ readme.md [0.65 KB]
   ├─ tsconfig.json [0.45 KB]
   ├─ tsconfig.webview.json [0.46 KB]
   ├─ out/
   │  ├─ extension.js [7.26 KB]
   │  ├─ extension.js.map [5.27 KB]
   │  ├─ parser/ (2 files) [20.45 KB]
   │  ├─ providers/ (4 files) [68.19 KB]
   │  ├─ services/ (4 files) [12.69 KB]
   │  ├─ types/ (2 files) [0.22 KB]
   │  └─ webview/ (6 files) [27.52 KB]
   ├─ resources/
   │  ├─ bundle.js [72.1 KB]
   │  ├─ style.css [4.57 KB]
   │  ├─ template.html [1.73 KB]
   │  └─ icons/ (5 files) [1.25 KB]
   └─ src/
      ├─ extension.ts [5.79 KB]
      ├─ parser/ (1 file) [10.64 KB]
      ├─ providers/ (2 files) [34.21 KB]
      ├─ services/ (2 files) [5.34 KB]
      ├─ types/ (1 file) [0.9 KB]
      └─ webview/ (3 files) [60.11 KB]

=> Run vsce ls --tree to see all included files.

 DONE  Packaged: D:\Work\big-paper2\vscode-mdtodo\vscode-mdtodo-0.0.2.vsix (44 files, 99.78 KB)
Packaging completed.

[3/3] Done!

The VSIX file has been created in the current directory.
```

### 生成的 VSIX 文件

- 文件名：`vscode-mdtodo-0.0.2.vsix`
- 路径：`d:\Work\big-paper2\vscode-mdtodo\vscode-mdtodo-0.0.2.vsix`
- 大小：99.78 KB
- 包含文件数：44 个

## 使用方法

### 方式一：命令行安装

```bash
code --install-extension vscode-mdtodo-0.0.2.vsix
```

### 方式二：GUI 安装

1. 打开 VS Code
2. 按 `Ctrl+Shift+P` 打开命令面板
3. 输入 "Extensions: Install from VSIX"
4. 选择 `vscode-mdtodo-0.0.2.vsix` 文件

## 后续优化项（可选）

- 添加 LICENSE 文件以消除警告
- 在 package.json 中添加 repository 字段
