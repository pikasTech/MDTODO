# R27 动态高度编辑框实现

## 需求说明

编辑框的高度要根据文本框内的文字的行数调整，行数越多的文本框要越高。

## 实现方案

在 `TaskList.tsx` 的 `TaskItem` 组件中添加动态高度计算逻辑：

1. 定义行高常量 `LINE_HEIGHT = 21px`（14px * 1.5）
2. 设置最小行数 `MIN_LINES = 3` 行，最大行数 `MAX_LINES = 15` 行
3. 编写 `calculateTextareaHeight()` 函数，根据文本行数计算高度
4. 使用 `useState` 保存计算出的高度，使用 `useEffect` 监听编辑内容变化
5. 将计算出的高度应用到 textarea 的 `style.height` 属性

## 代码修改

### TaskList.tsx 修改

```tsx
// 【修复R27】计算textarea高度：根据行数动态调整
const LINE_HEIGHT = 21; // 行高 = 14px * 1.5 = 21px
const MIN_LINES = 3;    // 最小3行
const MAX_LINES = 15;   // 最大15行
const PADDING = 16;     // 上下padding = 8px * 2

const calculateTextareaHeight = (text: string): string => {
  const lineCount = (text.match(/\n/g) || []).length + 1;
  const clampedLines = Math.max(MIN_LINES, Math.min(MAX_LINES, lineCount));
  return `${clampedLines * LINE_HEIGHT + PADDING}px`;
};

const [textareaHeight, setTextareaHeight] = React.useState(() =>
  calculateTextareaHeight(task.rawContent || task.title)
);

// 当编辑内容变化时，重新计算高度
React.useEffect(() => {
  setTextareaHeight(calculateTextareaHeight(editValue));
}, [editValue]);
```

将动态高度应用到 textarea：

```tsx
React.createElement('textarea', {
  ref: titleInputRef,
  className: 'task-title-edit',
  value: editValue,
  onChange: handleChange,
  onBlur: (e: React.FocusEvent<HTMLTextAreaElement>) => handleTitleBlur(e, task.id),
  onKeyDown: handleTitleKeyDown,
  placeholder: '输入任务内容...',
  style: { height: textareaHeight }  // 动态高度
})
```

### TaskList.css 修改

移除固定 `min-height`，改为由 JS 动态控制：

```css
/* 【修复R22.4/R27】编辑模式使用原生textarea，高度根据内容动态调整 */
.task-title-edit {
  font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
  font-size: 14px;
  background-color: #1e1e1e;
  border: 1px solid #3c3c3c;
  border-radius: 3px;
  color: #e0e0e0;
  padding: 8px 12px;
  width: 100%;
  resize: vertical;
  outline: none;
  line-height: 1.5;
  white-space: pre-wrap;
  word-wrap: break-word;
  overflow-wrap: break-word;
  min-height: 0; /* 覆盖CSS默认，由JS动态控制高度 */
}
```

## 效果说明

- 短文本（1-2行）：编辑框高度约为 79px（3行）
- 中等文本（3-5行）：编辑框高度随行数增加
- 长文本（超过15行）：编辑框高度保持在最大高度，约 331px
- 编辑过程中实时调整高度，无需保存后刷新

## 构建验证

执行 `esbuild` 重新打包 bundle.js，构建成功。
