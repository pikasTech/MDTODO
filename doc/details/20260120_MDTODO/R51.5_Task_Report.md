# R51.5 任务报告：筛选栏收起/展开功能实现

## 任务目标

实现"搜索，跳转"筛选栏的收起/展开功能：
1. 默认向上收起
2. 鼠标移动到标题区域时，下拉展开
3. 无论展开还是收起，都不应推挤task内容，而是遮挡上方内容

## 实现方案

### 1. 状态管理 (TaskList.tsx)

```typescript
// 【实现R51.5】筛选栏展开/收起状态，默认收起
const [filterBarExpanded, setFilterBarExpanded] = React.useState(false);
// 防抖状态，避免频繁切换
const filterBarTransitioning = React.useRef(false);
```

### 2. 筛选栏渲染逻辑

修改 `renderFilterBar` 函数，支持两种状态：
- **展开状态**：显示完整的筛选栏（跳转、状态筛选、搜索、添加任务等）
- **收起状态**：显示简化的入口（图标 + 提示文字）

### 3. 鼠标悬停触发

在 header 和筛选栏容器上添加 `onMouseEnter` 和 `onMouseLeave` 事件：
- 鼠标进入 header 区域时展开筛选栏
- 鼠标离开 header 和筛选栏区域时收起筛选栏
- 使用 `stopPropagation()` 防止事件冒泡导致意外收起

### 4. CSS 定位方式

```css
/* 【实现R51.5】筛选栏容器 - 使用绝对定位覆盖在内容上方 */
.filter-bar-container {
  position: absolute;
  top: 45px; /* header高度略下方 */
  left: 0;
  right: 0;
  z-index: 100;
}
```

关键点：
- 使用 `position: absolute` 脱离文档流
- 不再使用 `position: sticky`
- `z-index: 100` 确保覆盖在task内容上方
- 这样展开/收起时只会在视觉上遮挡内容，不会改变布局

## 修改文件

1. **src/webview/components/TaskList.tsx**
   - 添加 `filterBarExpanded` 状态
   - 修改 `renderFilterBar` 函数支持收起/展开两种状态
   - 在 header 上添加鼠标事件监听

2. **src/webview/bundle.css**
   - 添加 `.filter-bar-container` 绝对定位样式
   - 添加 `.filter-bar-collapsed` 收起状态样式
   - 添加 `.filter-bar-collapsed-text` 和 `.filter-bar-hint` 样式

## 测试方法

1. 打开 MDTODO 插件
2. 验证筛选栏默认显示为收起状态（显示"🔍 搜索 / 跳转"和提示文字）
3. 鼠标移动到header区域，验证筛选栏展开
4. 鼠标离开header和筛选栏区域，验证筛选栏收起
5. 验证展开/收起过程中不会推挤task内容，而是遮挡

## 注意事项

- 使用 `stopPropagation()` 防止事件冒泡，确保在筛选栏内移动时不会触发收起
- 收起状态只显示简化入口，保持界面简洁
- 使用绝对定位实现覆盖效果，不影响task列表布局
