# R36 报告模板与光标位置执行记录

## 需求说明

在新建任务后，自动在任务文本中添加"完成任务后将详细报告写入[Rxx]({path_to_rxx})"。然后将光标移动到输入框的最开始。这样用户就不需要自己编写报告写入的文件名和路径了。

## 执行记录

### 修改文件

1. **vscode-mdtodo/src/providers/webviewProvider.ts**
   - `handleAddTask` 方法：添加报告模板生成逻辑
   - `handleAddSubTask` 方法：添加报告模板生成逻辑（子任务）

2. **vscode-mdtodo/src/webview/components/TaskList.tsx**
   - `TaskItem` 组件：修改光标位置逻辑，从末尾改为开头

### 详细修改

#### 1. webviewProvider.ts - handleAddTask

```typescript
// 【R36】构建报告文件路径和模板内容
const fileDir = path.dirname(this.currentFilePath);
const fileName = path.basename(this.currentFilePath, '.md');
// 生成报告文件路径，如 ./details/20260120_MDTODO/R36_任务描述.md
const reportPath = `./details/${fileName}/${newId}_任务描述.md`;
// 新任务内容模板，包含报告写入提示
const newTaskContent = `## ${newId}\n\n完成任务后将详细报告写入[${newId}](${reportPath})。`;
```

#### 2. webviewProvider.ts - handleAddSubTask

```typescript
// 【R36】构建报告文件路径和模板内容
const fileName = path.basename(this.currentFilePath, '.md');
// 生成报告文件路径，如 ./details/20260120_MDTODO/R36.1_任务描述.md
const reportPath = `./details/${fileName}/${newId}_任务描述.md`;
// 新任务内容模板，包含报告写入提示
const newTaskContent = `### ${newId}\n\n完成任务后将详细报告写入[${newId}](${reportPath})。`;
```

#### 3. TaskList.tsx - 光标位置

```typescript
// 【R36】将光标移动到输入框的最开始，而不是末尾
React.useEffect(() => {
  if (isEditMode && titleInputRef.current) {
    titleInputRef.current.focus();
    // 将光标移到文本开头
    titleInputRef.current.selectionStart = 0;
    titleInputRef.current.selectionEnd = 0;
  }
}, [isEditMode]);
```

### 效果说明

1. **新建主任务**：添加任务后，任务内容自动填充为：
   ```
   ## R36

   完成任务后将详细报告写入[R36](./details/20260120_MDTODO/R36_任务描述.md)。
   ```

2. **新建子任务**：添加子任务后，任务内容自动填充为：
   ```
   ### R36.1

   完成任务后将详细报告写入[R36.1](./details/20260120_MDTODO/R36.1_任务描述.md)。
   ```

3. **光标位置**：用户点击添加任务后，光标自动定位到输入框的最开始位置，方便用户直接输入任务描述。

### 测试验证

1. 点击"+ 添加任务"按钮
2. 验证新任务内容包含报告模板
3. 验证光标位于输入框开头
4. 点击"+ 子任务"按钮
5. 验证子任务内容包含报告模板
6. 验证光标位于输入框开头

### 注意事项

- 报告文件路径基于当前TODO文件名生成，如 `20260120_MDTODO`
- 报告文件存放在 `details/{TODO文件名}/` 目录下
- 报告文件名格式为 `{Rxx}_任务描述.md`
