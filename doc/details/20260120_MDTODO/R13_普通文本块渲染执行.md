# R13 普通文本块渲染功能执行记录

## 任务描述

不包含 RXX 的标题 + 内容块不要渲染为任务，应该渲染为普通文本块。

## 执行时间

2026-01-21

## 修改文件列表

### 1. `src/types/index.ts`

添加 `TextBlock` 接口和更新 `TodoFile` 接口：

```typescript
export interface TextBlock {
  id: string;           // 文本块唯一标识
  content: string;      // 文本块内容
  lineNumber: number;   // 在文件中的行号
}

export interface TodoFile {
  filePath: string;
  tasks: TodoTask[];
  textBlocks?: TextBlock[]; // 非RXX的普通文本块
}
```

### 2. `src/parser/index.ts`

**修改内容：**

1. 添加 `hasRxxId` 辅助函数，用于检查文本是否包含 RXX 格式的任务ID

2. 修改 `tokenizer` 方法：
   - 只有包含 RXX 格式（如 R13, R13.1）的 `##` 或 `###` 开头的标题才标记为 `task`
   - 不包含 RXX 的标题作为普通文本块处理，标记为 `text` 类型

3. 添加 `parseTextBlocks` 方法：
   - 解析并收集非 RXX 格式的普通文本块

4. 更新 `parseFile` 方法：
   - 同时返回 tasks 和 textBlocks

### 3. `src/providers/webviewProvider.ts`

**修改内容：**

1. 添加 `currentTextBlocks` 状态变量

2. 更新 `sendToWebview` 方法：
   - 在发送到前端的消息中包含 textBlocks

3. 更新 `tryLoadFile` 和 `loadFile` 方法：
   - 解析文件时同时获取 textBlocks

### 4. `src/webview/components/TaskList.tsx`

**修改内容：**

1. 添加 `TextBlock` 接口定义

2. 添加 `initialTextBlocks` 属性到 `TaskListProps`

3. 添加 `textBlocks` 状态变量

4. 更新消息处理逻辑：
   - 接收并设置 textBlocks

5. 添加 `renderTextBlocks` 函数：
   - 渲染普通文本块为带样式的 div 元素

6. 更新主渲染逻辑：
   - 在任务列表上方显示普通文本块

## 技术实现细节

### 文本块识别规则

只有满足以下条件的标题才会被识别为任务：
- 以 `##` 或 `###` 或 `####` 开头
- 包含 RXX 格式的任务ID（如 `R13`、`R13.1`）

不满足上述条件的标题（如 `## 重要说明：`、`## 总需求`）会被识别为普通文本块。

### 文本块渲染样式

普通文本块以灰色背景的 div 元素渲染，样式如下：
- 背景色：#2d2d2d
- 文字颜色：#a0a0a0
- 字体大小：13px
- 内边距：8px 12px
- 圆角：4px

## 测试验证

编译成功，前端代码已更新。可以在 VSCODE 中打开 TODO 文件测试：
- 包含 RXX 格式的任务正常渲染
- 不包含 RXX 的标题作为普通文本块显示

## 注意事项

1. 文本块的 ID 格式为 `text-行号`，用于 React key 渲染
2. 空行和纯链接行（如 `[Finished]`）会被过滤掉
3. 文本块显示在任务列表上方，与任务列表有明显的视觉区分
