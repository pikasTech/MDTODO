# 阶段一详细执行计划：项目初始化与基础框架

## 目标

搭建开发环境，创建项目基础结构，配置构建工具，使插件可正常运行加载。

## 前置条件

- Node.js (v16+)
- VSCode编辑器
- Claude Code CLI已安装并配置

## 执行步骤

### 步骤1.1：创建插件项目

```bash
# 创建项目目录
mkdir -p vscode-mdtodo
cd vscode-mdtodo

# 初始化npm项目
npm init -y

# 安装Yeoman生成器（如果未安装）
npm install -g yo generator-code

# 生成插件项目
yo code
```

**选择配置**：
- 语言：TypeScript
- 包管理工具：npm（Windows）或 yarn

### 步骤1.2：项目结构创建

```bash
# 创建目录结构
mkdir -p src/parser
mkdir -p src/providers
mkdir -p src/services
mkdir -p src/types
mkdir -p resources/icons
mkdir -p resources/webview
mkdir -p test
```

### 步骤1.3：安装构建工具

```bash
# 安装TypeScript
npm install --save-dev typescript

# 安装VSCode类型定义
npm install --save-dev @types/vscode

# 安装Webpack（用于打包）
npm install --save-dev webpack webpack-cli vscode-webpack-plugin

# 安装开发工具
npm install --save-dev @types/node
```

### 步骤1.4：配置TypeScript

创建/更新 `tsconfig.json`：

```json
{
  "compilerOptions": {
    "module": "commonjs",
    "target": "ES2020",
    "outDir": "out",
    "lib": ["ES2020"],
    "sourceMap": true,
    "rootDir": "src",
    "strict": true,
    "esModuleInterop": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "out", "test"]
}
```

### 步骤1.5：配置Webpack

创建 `webpack.config.js`：

```javascript
const path = require('path');
const VscodeWebpackPlugin = require('vscode-webpack-plugin');

module.exports = {
  mode: 'production',
  entry: './src/extension.ts',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'extension.js',
    libraryTarget: 'commonjs2',
    devtoolModuleFilenameTemplate: '../[resource-path]'
  },
  externals: {
    vscode: 'commonjs vscode'
  },
  resolve: {
    extensions: ['.ts', '.js'],
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },
  module: {
    rules: [
      {
        test: /\.ts$/,
        exclude: /node_modules/,
        use: ['ts-loader']
      }
    ]
  },
  plugins: [
    new VscodeWebpackPlugin()
  ]
};
```

### 步骤1.6：配置package.json

更新 `package.json` 的build脚本：

```json
{
  "scripts": {
    "compile": "tsc -p ./",
    "watch": "tsc -watch -p ./",
    "prepack": "npm run compile",
    "package": "vsce package"
  }
}
```

### 步骤1.7：实现插件入口

创建 `src/extension.ts`：

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
  console.log('MDTODO插件已激活');

  // 临时命令：验证插件加载
  const disposable = vscode.commands.registerCommand('mdtodo.helloWorld', () => {
    vscode.window.showInformationMessage('MDTODO插件已启动!');
  });

  context.subscriptions.push(disposable);
}

export function deactivate() {
  console.log('MDTODO插件已停用');
}
```

### 步骤1.8：测试插件加载

1. 按F5启动调试，会打开新的VSCode窗口
2. 在新窗口中按Ctrl+Shift+P打开命令面板
3. 输入 "MDTODO: Hello World" 并执行
4. 验证弹出的信息框显示正常

## 验收标准

- [ ] 插件项目结构完整
- [ ] TypeScript编译无错误
- [ ] F5调试可正常加载插件
- [ ] 注册的命令可正常执行

## 预计产出

- 项目根目录：`vscode-mdtodo/`
- 入口文件：`src/extension.ts`
- 配置文件：`package.json`, `tsconfig.json`, `webpack.config.js`

## 备注

- 如果使用esbuild替代Webpack，可以显著加快构建速度
- 可以考虑使用vscode-dev-container实现开发环境容器化
