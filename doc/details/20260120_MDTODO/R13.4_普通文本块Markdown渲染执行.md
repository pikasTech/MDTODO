# R13.4 普通文本块Markdown渲染执行

## 任务要求

普通文本块也要使用markdown渲染模块来渲染。

## 执行内容

### 问题分析

之前的 `renderTextBlocks` 函数直接显示原始文本内容，没有使用 markdown 渲染。而任务标题在非编辑模式下已经使用了 `marked` 库进行 markdown 渲染。

### 修改位置

`vscode-mdtodo/src/webview/components/TaskList.tsx` 中的 `renderTextBlocks` 函数。

### 修改内容

1. 为文本块添加 HTML 转义函数 `escapeHtml`
2. 使用 `marked.parse()` 渲染 markdown 内容
3. 使用 `dangerouslySetInnerHTML` 注入渲染后的 HTML

### 修改前后对比

**修改前**：
```typescript
const renderTextBlocks = () => {
  if (!textBlocks || textBlocks.length === 0) return null;
  return React.createElement('div', { className: 'text-blocks' },
    textBlocks.map((block) =>
      React.createElement('div', {
        // ...样式
      }, block.content)  // 直接显示原始文本
    )
  );
};
```

**修改后**：
```typescript
const renderTextBlocks = () => {
  if (!textBlocks || textBlocks.length === 0) return null;

  const escapeHtml = (text: string) => {
    return text
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  };

  return React.createElement('div', { className: 'text-blocks' },
    textBlocks.map((block) => {
      let renderedContent;
      try {
        renderedContent = marked.parse(block.content, { async: false });
      } catch (error) {
        console.error('[Webview] TextBlock Markdown渲染错误:', error);
        renderedContent = escapeHtml(block.content);
      }

      return React.createElement('div', {
        // ...样式
        dangerouslySetInnerHTML: { __html: renderedContent as string }
      });
    })
  );
};
```

## 测试结果

编译成功。普通文本块现在会使用 marked 库正确渲染 markdown 语法（如链接、粗体、列表等）。
