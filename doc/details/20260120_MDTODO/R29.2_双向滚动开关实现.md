# R29.2 双向滚动同步开关实现

## 任务目标

在右上角增加一个图标按钮控制是否开启双向滚动同步功能，默认不开启。

## 实现内容

### 1. 新增状态变量

在 `TaskList.tsx` 中添加双向滚动开关状态：

```typescript
// 【实现R29.2】双向滚动同步开关，默认关闭
const [syncScrollEnabled, setSyncScrollEnabled] = React.useState(false);
```

### 2. 新增切换函数

添加处理按钮点击的切换函数：

```typescript
// 【实现R29.2】切换双向滚动同步开关
const handleToggleSyncScroll = () => {
  const newState = !syncScrollEnabled;
  setSyncScrollEnabled(newState);
  console.log('[Webview] 双向滚动同步:', newState ? '开启' : '关闭');
  // 发送状态变更通知
  sendMessage({ type: 'syncScrollChanged', enabled: newState });
};
```

### 3. 修改滚动处理逻辑

在 `handleScroll` 函数中添加开关判断：

```typescript
// 【实现R29】处理滚动事件 - 当用户滚动webview时，同步到VSCode编辑器
const handleScroll = React.useCallback(() => {
  // 【实现R29.2】如果同步开关关闭，不处理滚动同步
  if (!syncScrollEnabled) {
    return;
  }
  // ... 其余滚动处理逻辑
}, [tasks, sendMessage, syncScrollEnabled]);  // 添加 syncScrollEnabled 依赖
```

### 4. 添加开关按钮

在 header-actions 区域添加同步滚动开关按钮（位于最左侧）：

```typescript
// 【实现R29.2】双向滚动同步开关按钮
React.createElement('button', {
  className: `sync-scroll-btn ${syncScrollEnabled ? 'enabled' : ''}`,
  onClick: handleToggleSyncScroll,
  title: syncScrollEnabled ? '关闭双向滚动同步' : '开启双向滚动同步'
},
  // SVG图标：双向箭头表示同步
  React.createElement('svg', { viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: 2, width: 16, height: 16 },
    React.createElement('path', { d: 'M17 1l4 4-4 4' }),
    React.createElement('path', { d: 'M3 11V9a4 4 0 0 1 4-4h14' }),
    React.createElement('path', { d: 'M7 23l-4-4 4-4' }),
    React.createElement('path', { d: 'M21 13v2a4 4 0 0 1-4 4H3' })
  )
)
```

### 5. 添加CSS样式

在 `TaskList.css` 中添加按钮样式：

```css
/* 【实现R29.2】双向滚动同步开关按钮样式 */
.sync-scroll-btn {
  padding: 6px;
  border: 1px solid #3c3c3c;
  border-radius: 4px;
  background-color: #1e1e1e;
  color: #888;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s ease;
}

.sync-scroll-btn:hover {
  background-color: #3c3c3c;
  color: #d4d4d4;
}

.sync-scroll-btn.enabled {
  background-color: #1e3a1e;
  border-color: #2d7a2d;
  color: #4ade4a;
}

.sync-scroll-btn.enabled:hover {
  background-color: #2d5a2d;
  color: #6ee06e;
}

.sync-scroll-btn svg {
  width: 16px;
  height: 16px;
}
```

## 功能说明

1. **默认状态**：双向滚动同步默认关闭，用户需要手动点击按钮开启
2. **按钮样式**：
   - 关闭状态：灰色背景，深灰色边框
   - 开启状态：绿色背景，亮绿色边框和图标
3. **图标设计**：使用双向箭头 SVG 图标，表示同步功能
4. **Tooltip**：鼠标悬停时显示"开启双向滚动同步"或"关闭双向滚动同步"

## 修改文件列表

1. `vscode-mdtodo/src/webview/components/TaskList.tsx`
   - 添加 `syncScrollEnabled` 状态变量
   - 添加 `handleToggleSyncScroll` 函数
   - 修改 `handleScroll` 函数添加开关判断
   - 在 header-actions 添加同步开关按钮

2. `vscode-mdtodo/src/webview/components/TaskList.css`
   - 添加 `.sync-scroll-btn` 相关样式

## 测试方法

1. 打开 MDTODO 插件
2. 打开一个 TODO 文件
3. 点击右上角的双向滚动同步按钮
4. 验证：
   - 按钮样式变化（变为绿色高亮）
   - 开启后，滚动 webview 会同步滚动 VSCode 编辑器
   - 关闭后，滚动 webview 不会同步滚动编辑器
   - VSCode 编辑器滚动仍可同步到 webview（根据焦点状态）
